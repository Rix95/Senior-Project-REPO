<template>
    <section class="package-search-grid">
      <el-card class="search-card">
        <h3>Search for a Package</h3>
        <el-input
          v-model="q"
          placeholder="Type package nameâ€¦"
          @input="debouncedSearch"
          clearable
          class="mt-2"
        >
          <template #append>
            <el-button @click="searchNow">Search</el-button>
          </template>
        </el-input>
      </el-card>
  
      <el-card v-if="results.length">
        <h3>Results ({{ results.length }})</h3>
        <el-table :data="results" stripe style="width:100%">
          <el-table-column prop="VulnerabilityID" label="ID" width="180"/>
          <el-table-column prop="Summary"         label="Summary"/>
        </el-table>
      </el-card>
  
      <el-empty v-else description="No data yet"/>
    </section>
  </template>
  
  <script setup>
  import { ref } from 'vue'
  import { ElMessage } from 'element-plus'
  import { searchVulnerabilities } from '../services/api'
  import debounce from 'lodash.debounce'
  
  const q       = ref('')
  const results = ref([])
  
  const fetchResults = async () => {
    if (!q.value.trim()) { results.value = []; return }
    try {
      const { data } = await searchVulnerabilities(q.value)
      results.value  = Array.isArray(data.results) ? data.results : []
    } catch (e) {
      ElMessage.error('API error'); results.value=[]
    }
  }
  
  const debouncedSearch = debounce(fetchResults, 400)
  const searchNow       = () => debouncedSearch.flush()
  </script>
  